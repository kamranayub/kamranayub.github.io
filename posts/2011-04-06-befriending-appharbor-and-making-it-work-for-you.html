<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

  <title>Kamranicus - Befriending AppHarbor and Making it Work for You</title>
  <meta name="description" content="Kamran Ayub" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Kamran Ayub">

  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus (RSS)" type="application/atom+xml">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.png" type="image/png">

  <link href="/assets/ui/semantic.min.css" rel="stylesheet" />
  <link href="/assets/css/highlight.css" rel="stylesheet">

  <meta name="application-name" content="Kamranicus" />
  <meta name="msapplication-tooltip" content="Kamranicus" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Kamranicus - Befriending AppHarbor and Making it Work for You" /> 
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kamranicus.com/posts/2011-04-06-befriending-appharbor-and-making-it-work-for-you" />
  <meta property="og:site_name" content="Kamranicus" />

  <!-- TODO: More social graph meta tags -->
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": "Kamranicus",
      "url": "https://kamranicus.com/",
      "sameAs": [
        "http://www.twitter.com/kamranayub"
      ]
  }
  </script>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/assets/js/html5shiv.js"></script>
    <script src="/assets/js/respond.min.js"></script>
  <![endif]-->
  <script src="/assets/js/picturefill.min.js" async></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  

  


</head>

<body>

  <!-- Navigation -->
  <div class="ui container">
    <nav class="ui huge text site menu">
      
      <a class="header item" href="/">Kamranicus</a>
      
      <div class="ui right item">
              <div class="item">
        <a href="/about">Contact</a>
      </div>
      <div class="item">
        <a href="/guides">Guides</a>
      </div>
      <div class="item">
        <a href="/projects">Projects</a>
      </div>
      <div class="item">
        <a href="/events">Talks &amp; Events</a>
      </div>
      <div class="item">
        <a href="/travel">Travel</a>
      </div>

      </div>
    </nav>
  </div>
  <!-- Page Header -->

  <header class="ui vertical masthead segment  " id="intro-header">
    <div class="ui container">

    
<div class="ui basic vertical segment">
    <h1 class="ui  huge header">
      Befriending AppHarbor and Making it Work for You
    </h1>
                
    <div class="ui  sub header">        
Published on Wednesday, April 6, 2011<br>    </div>
        <div class="ui basic vertical spaced segment">
                    <a role="button" href="/tags/AppHarbor" class="ui small compact button">AppHarbor</a>
                    <a role="button" href="/tags/Continuous-Deployment" class="ui small compact button">Continuous Deployment</a>
                    <a role="button" href="/tags/Continuous-Integration" class="ui small compact button">Continuous Integration</a>
        </div>     
</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="ui stackable grid container">
    <div class="content column">
      

<div class="ui huge basic post content segment">
  <p>I chose to partially host my site on <a href="http://appharbor.com">AppHarbor</a> because it affords several luxuries for <strong>free</strong>:</p>
<ul>
<li>Load balancing</li>
<li>Automatic builds and deploys</li>
<li>Fast and easy setup/maintenance</li>
<li>Private Git hosting</li>
</ul>
<p>However, it does fall short in a couple areas:</p>
<ol>
<li>Native support for a staging environment</li>
<li>Free database is only 20MB and it's $10/mo for a 10GB database</li>
<li>Any more instances incur about $36/mo each</li>
</ol>
<p>There are workarounds for the first two issues, which I will cover here. The third is a judgement call on your part, whether you think it's worth the cost. For me, I don't need another instance.</p>
<h2 id="setting-up-a-staging-environment">Setting up a Staging Environment</h2>
<p>You <em>can</em> set up a staging environment in AppHarbor. I needed several things for my staging environment:</p>
<ol>
<li>Is a sub-domain</li>
<li>Is protected so only I can access it</li>
</ol>
<p>Here is what I did:</p>
<ol>
<li>In AppHarbor, create a new application (e.g. <em>Kamranicus-Dev</em>)</li>
<li>Locally, add this new application as a new remote to your Git:
<ul>
<li><code>git remote add appharbor-stage {your new app Git url}</code></li>
</ul>
</li>
<li>In the <strong>Configuration Variables</strong> section of your AppHarbor application, add a new variable:
<ul>
<li><code>RuntimeEnvironment</code> with a value of <code>Staging</code></li>
</ul>
</li>
<li>In your <strong>web.config</strong>, you can now add a new <code>appSetting</code>:
<ul>
<li><code>&lt;add key=&quot;RuntimeEnvironment&quot; value=&quot;Local&quot; /&gt;</code></li>
</ul>
</li>
</ol>
<p>Now, when you push to your new <code>appharbor-stage</code> remote, AppHarbor will automatically replace that app setting with the value <code>Staging</code>.</p>
<p>At this point, you're all done. You can now add a host name like <strong>stage.kamranicus.com</strong> to point to your staging site.</p>
<p>To push to your staging environment:</p>
<pre><code>git push appharbor-stage master
</code></pre>
<p>If you're wondering about connection strings, you will need to test for the current <code>RuntimeEnvironment</code> and use one of your choosing:</p>
<pre><code>var runtimeEnvironment = ConfigurationManager.AppSettings[&quot;RuntimeEnvironment&quot;].ToString();
</code></pre>
<h3 id="adding-protection">Adding protection</h3>
<p>If you're like me, you don't want everyone looking at your new changes before they're ready and you sure as hell don't want people adding stuff to your development database.</p>
<p>I am using Forms authentication in conjunction with OpenID for Kamranicus. Thus, I needed a to make a special attribute for my <code>BaseController</code> that programmatically decided whether or not to restrict access to the controller based on the runtime environment.</p>
<pre><code class="language-c#">using System;
using System.Configuration;
using System.Web.Mvc;

namespace System.Web.Mvc {
	public class AuthorizeLocalAttribute : AuthorizeAttribute {
		private const string LOCAL = &quot;Local&quot;;
		private const string STAGING = &quot;Staging&quot;;

		protected override bool AuthorizeCore(HttpContextBase httpContext) {
			// Ignore all Account controller calls (Anonymous)
			if (httpContext.Request.RequestContext.RouteData.Values[&quot;controller&quot;].ToString() == &quot;Account&quot;)
				return true;

			// Get runtime environment
			string runtimeEnvironment = ConfigurationManager.AppSettings[&quot;RuntimeEnvironment&quot;];

			if (runtimeEnvironment == STAGING) {
				return base.AuthorizeCore(httpContext);
			}
			else {
				return true;
			}
		}
	}
}
</code></pre>
<p>You can then apply this attribute to your <code>BaseController</code>:</p>
<pre><code class="language-c#">    [AuthorizeLocal(Users = &quot;MyAdminID&quot;)]
    public abstract class BaseController : Controller {
        // yada yada yada
    }
</code></pre>
<h2 id="does-it-work">Does it work?</h2>
<p>This is the method I use and it seems to work great. Note that you can create any number of environments like this and programmatically do different things based on what gets injected in by AppHarbor.</p>
<h2 id="taking-care-of-storage">Taking care of storage</h2>
<p>For my blog I store all my images in the database. This means that I would quickly run over the 20MB in the free database allotted by AppHarbor. I also don't want to pay an extra $10/mo for a database.</p>
<p>Instead, I already have an account with <a href="http://arvixe.com">Arvixe</a> and as far as I could tell, it is not against the TOS of AppHarbor to host your database externally. So that's what I did. I get to use my Arvixe account for not only DB hosting, but also the mail server and other hosting provider options for a measley $10/mo (it also hosts some other sites I own).</p>

</div>

<h3 class="ui horizontal divider">
  Don't miss any updates!
</h3>

<div class="ui two column mobile tablet computer reversed divided grid">
  <div class="row">
    <div class="column">
      <p class="ui text tiny"><em>No spam and I usually send a newsletter once a quarter with content you won't see on the blog.</em></p>
    </div>
    <div class="column">
      <div class="ui items" id="mc_embed_signup">
        <form action="https://kamranicus.us18.list-manage.com/subscribe/post?u=45a27b0b6fc6f929b90e35338&amp;id=89bb6697c0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
          <div class="item" id="mc_embed_signup_scroll">
            <div class="content">
              <div class="ui input">
                <input type="email" value="" name="EMAIL" placeholder="Your Email" class="required email" id="mce-EMAIL">
              </div>
              <div id="mce-responses" class="clear" style="margin-top: 1em;">
                <div class="response" id="mce-error-response" style="display:none"></div>
                <div class="response" id="mce-success-response" style="display:none"></div>
              </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_45a27b0b6fc6f929b90e35338_89bb6697c0" tabindex="-1" value=""></div>
              <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="ui primary button"></div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="ui horizontal divider">
  About Kamran
</div>

<div class="ui items">
  <div class="item">
    <div class="ui small circular image">
      <img src="/assets/images/me.jpg" title="Kamran Ayub">
    </div>

    <div class="content">
      <div class="description">
        I&#x27;m a technologist, speaker, and Pluralsight author and I specialize in building full-stack solutions with a focus on modern web technology and cloud native architecture.
      </div>
      <div class="extra">
        <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
      </div>
    </div>
  </div>
</div>

<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = '2';
    var disqus_title = 'Befriending AppHarbor and Making it Work for You';
    var disqus_url = 'https://kamranicus.com/posts/2011-04-06-befriending-appharbor-and-making-it-work-for-you';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <!-- Disqus -->
<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = '2';
    var disqus_title = 'Befriending AppHarbor and Making it Work for You';
    var disqus_url = 'https://kamranicus.com/posts/2011-04-06-befriending-appharbor-and-making-it-work-for-you';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>    </div>
  </div>

  <div class="ui divider"></div>
  
  <!-- Footer -->
  <footer>   
    <div class="ui center aligned container">
  <p class="ui grey sub header">Copyright © Kamran Ayub 2019</p>
  
  <div class="ui basic vertical segment">
    <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
  </div>

  <p class="ui basic vertical segment">      
    <a href="http://feeds.feedburner.com/Kamranicus" class="ui right labeled icon button">
      Subscribe via RSS or email
      <i class="right rss icon"></i>
    </a>
  </p>  
  <p class="ui tiny basic vertical segment">
    <a href="https://wyam.io">Statically generated by Wyam</a>
  </p>
</div>

  </footer>

  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  <script src="/assets/ui/semantic.min.js"></script>
  <script src="/assets/js/highlight.pack.js"></script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6930375300621668",
          enable_page_level_ads: true
     });
</script>

  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>