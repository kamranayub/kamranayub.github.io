<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

  <title>Kamranicus | Kamran Ayub - Controlling Browser Permissions in Cypress End-to-End Tests</title>
  <meta name="description" content="Kamran Ayub" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Kamran Ayub">

  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus (RSS)" type="application/atom+xml">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.png" type="image/png">

  <link href="/assets/ui/semantic.min.css" rel="stylesheet" />
  <link href="/assets/css/highlight.css" rel="stylesheet">

  <meta name="monetization" content="$ilp.uphold.com/GkRBn6N6hM9q" />
  
  <meta name="application-name" content="Kamranicus | Kamran Ayub" />
  <meta name="msapplication-tooltip" content="Kamranicus | Kamran Ayub" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Kamranicus | Kamran Ayub - Controlling Browser Permissions in Cypress End-to-End Tests" /> 
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kamranicus.com/posts/2020-07-17-cypress-browser-permissions" />
  <meta property="og:site_name" content="Kamranicus" />
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:creator" content="@kamranayub" />

  <!-- TODO: More social graph meta tags -->
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": "Kamranicus",
      "url": "https://kamranicus.com/",
      "sameAs": [
        "http://www.twitter.com/kamranayub"
      ]
  }
  </script>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/assets/js/html5shiv.js"></script>
    <script src="/assets/js/respond.min.js"></script>
  <![endif]-->
  <script src="/assets/js/picturefill.min.js" async></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  

  


</head>

<body>

  <!-- Navigation -->
  <div class="ui container">
    <nav class="ui huge text site menu">
      
      <a class="header item" href="/">Kamranicus | Kamran Ayub</a>
      
      <div class="ui right item">
              <div class="item">
        <a href="/about">Contact</a>
      </div>
      <div class="item">
        <a href="/events">Events</a>
      </div>
      <div class="item">
        <a href="/guides">Guides</a>
      </div>
      <div class="item">
        <a href="/projects">Projects</a>
      </div>
      <div class="item">
        <a href="/training">Training</a>
      </div>
      <div class="item">
        <a href="/travel">Travel</a>
      </div>

      </div>
    </nav>
  </div>
  <!-- Page Header -->

  <header class="ui vertical masthead segment  with-image" id="intro-header" style="background-image: url(&quot;https://user-images.githubusercontent.com/563819/87799786-42456780-c813-11ea-9e84-9a4ff71b72c8.png&quot;)">
    <div class="ui container">

    
<div class="ui basic vertical segment">
    <h1 class="ui  huge header">
      Controlling Browser Permissions in Cypress End-to-End Tests
        <div class="ui sub header">I&#x27;ve released an open source package, `cypress-browser-permissions` that handles managing browser permissions in Cypress</div>
    </h1>
                
    <div class="ui  sub header">        
Published on Friday, July 17, 2020<br>    </div>
        <div class="ui basic vertical spaced segment">
                    <a role="button" href="/tags/Cypress" class="ui small compact button">Cypress</a>
                    <a role="button" href="/tags/Open-Source" class="ui small compact button">Open Source</a>
                    <a role="button" href="/tags/Testing" class="ui small compact button">Testing</a>
        </div>     
</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="ui stackable grid container">
    <div class="content column">
      

<div class="ui huge basic post content segment">
  <p>I am excited to release a new open source package <a href="https://npmjs.com/package/cypress-browser-permissions">cypress-browser-permissions</a>. 🎉 You can view it on GitHub at <a href="https://github.com/kamranayub/cypress-browser-permissions">kamranayub/cypress-browser-permissions</a>.</p>
<p>This package solves a real need when testing more sophisticated applications when using <a href="https://cypress.io">Cypress</a>, the end-to-end testing framework. It helps control the permission level of various browser features such as:</p>
<ul>
<li>Desktop Notifications</li>
<li>Geolocation</li>
<li>Images</li>
<li>Camera</li>
<li>Microphone</li>
<li>etc.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/563819/87500464-2169f000-c622-11ea-8dbb-a480a6f137ac.png" class="img-fluid" alt="image" /></p>
<h2 id="how-to-use-it">How to Use It</h2>
<p>To get started, you'll need to install the package and you'll need Cypress installed already.</p>
<pre><code class="language-bash">npm i cypress cypress-browser-permissions --save-dev
</code></pre>
<p>If this is your first time installing Cypress, you'll need to run it once to generate a project structure:</p>
<pre><code class="language-bash">npx cypress open
</code></pre>
<p>Then, you need to initialize the plugin to hook it into Cypress' plugin pipeline. In <code>cypress/plugins/index.js</code>, modify it as follows:</p>
<pre><code class="language-diff">+ const { cypressBrowserPermissionsPlugin } = require('cypress-browser-permissions')

/**
 * &#64;type {Cypress.PluginConfig}
 */
module.exports = (on, config) =&gt; {
  // `on` is used to hook into various events Cypress emits
  // `config` is the resolved Cypress config
+ config = cypressBrowserPermissionsPlugin(on, config);
+ return config;
};
</code></pre>
<p>Now you will have the ability to control various permissions for Chrome, Edge, and Firefox using <a href="https://docs.cypress.io/guides/guides/environment-variables.html">Cypress environment variables</a>.</p>
<p>For example, if you want to just set permissions for your project you can do so in <code>cypress.json</code>:</p>
<pre><code class="language-json">{
  &quot;env&quot;: {
    &quot;browserPermissions&quot;: {
      &quot;notifications&quot;: &quot;allow&quot;,
      &quot;geolocation&quot;: &quot;allow&quot;
    }
  }
}
</code></pre>
<p>The plugin will read the permission settings and apply them when launching the browser. It will also reset between launches since modifying the browser profile is persisted across sessions.</p>
<p>You can read more about <a href="https://github.com/kamranayub/cypress-browser-permissions">supported permissions and values in the README</a>.</p>
<h3 id="writing-an-end-to-end-notification-test">Writing an End-to-End Notification Test</h3>
<p>So let's try it out! Once I finish my <strong>Testing Progressive Web Apps</strong> <a href="http://bit.ly/KamranOnPluralsight">Pluralsight course</a>, it will come with an open source sample app. In the meantime, we can write a basic test to see if permissions are working. This same test is included in the repo.</p>
<p>First, we have an HTML file that uses <code>window.Notification</code> to display a desktop notification:</p>
<p><strong>cypress/html/notification.html</strong></p>
<pre><code class="language-html">&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Cypress Notification Test&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        const n = new window.Notification('test', { body: 'This is a test!' })
        n.addEventListener('show', (e) =&gt; {
            window.__CypressNotificationShown = e;
        })
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>You can learn more about how the <a href="https://developer.mozilla.org/en-US/docs/Web/API/notification">Notification API</a> works but what we are doing is immediately triggering a notification. Once the browser shows the toast, it triggers the <code>show</code> event on the <code>Notification</code> instance. Since Cypress is awesome and we can hook directly into the <code>window</code> object, we set a callback value globally that we can then inspect/wait for in our test.</p>
<p>If you have a blank Cypress project you do not even need a server as Cypress will automatically host the root of the project when there is no other configuration.</p>
<p>Save the <code>notification.html</code> file under <code>cypress/html</code> and then we can visit that page in the test.</p>
<p>We can create a test suite in <code>cypress/integration</code>:</p>
<p><strong>cypress/integration/notification.test.js</strong></p>
<pre><code class="language-js">import { isPermissionAllowed } from 'cypress-browser-permissions';

describe(&quot;notifications&quot;, () =&gt; {
    it(&quot;should be enabled&quot;, () =&gt; {
        expect(isPermissionAllowed(&quot;notifications&quot;)).to.be.true;
    })

    // Only test notification showing in &quot;headed&quot; browsers, which also
    // works in CI :tada:
    Cypress.browser.isHeaded &amp;&amp; it(&quot;should display desktop notification&quot;, () =&gt; {
    
        // Visit the page we created previously
        cy.visit('/cypress/html/notification.html')
        
        // Wait for the window callback to populate with the event data
        cy.window().its('__CypressNotificationShown').should('exist');
    })
})
</code></pre>
<p>Now we can run our tests:</p>
<pre><code class="language-bash">npx cypress open
</code></pre>
<p>That's all! If <code>browserPermissions.notifications</code> is set to <code>allow</code> then our test should pass:</p>
<p><img src="https://user-images.githubusercontent.com/563819/87737665-3620c200-c7a1-11ea-8429-73bd40c99bed.png" class="img-fluid" alt="test run" /></p>
<p>And a notification will be shown!</p>
<p><img src="https://user-images.githubusercontent.com/563819/87737706-52bcfa00-c7a1-11ea-893e-9f6f8dec1e2e.png" class="img-fluid" alt="toast" /></p>
<h3 id="how-it-works">How It Works</h3>
<p>In Cypress, <a href="https://docs.cypress.io/api/plugins/browser-launch-api.html#Modify-browser-launch-arguments-preferences-and-extensions">you have control over the launch preferences for browsers</a>, so the magic lies in <em>what preferences to pass to each browser.</em></p>
<p>This topic is not heavily documented <a href="https://github.com/cypress-io/cypress/issues/2671">as evidenced by this open issue in the Cypress repo</a> I came across while researching this. It has been open since 2018 with no one mentioning the ability to control launch preferences.</p>
<p>Thanks to BrowserStack for <a href="https://www.browserstack.com/automate/handle-popups-alerts-prompts-in-automated-tests">documenting some of these permissions</a> as well as these StackOverflow posts:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/55435198/selenium-python-allow-firefox-notifications">Selenium + Python Allow Firefox Notifications</a></li>
<li><a href="https://stackoverflow.com/questions/48007699/how-to-allow-or-deny-notification-geo-location-microphone-camera-pop-up">How to allow or deny notification geo-location microphone camera pop up</a></li>
</ul>
<p>I was able to piece together the information needed to tackle this with a Cypress plugin. Since each browser family uses different preferences, I thought it would be best to abstract it.</p>
<h3 id="whats-next">What's Next?</h3>
<p>My hope is that this package is <em>actually short-lived</em> and the Cypress team can incorporate these permission settings into the core of the product, since it's such an important feature especially when testing new, modern APIs.</p>
<p>There will be a <strong>full sample</strong> of using Cypress with this plugin (as well as other black magicks such as bypassing service workers and more!) in my <em>Testing Progressive Web Apps</em> course soon on <a href="https://bit.ly/KamranOnPluralsight">Pluralsight</a>. It should be released in August, you can follow me there to get notified when it releases. The sample app will be open source on GitHub so you'll be able to reference it 👍</p>
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTQ2ODg5MTg5NCwyMTA1MzEzMTc4LDEzNj
M1NTM4NTldfQ==
-->

</div>

<h3 class="ui horizontal divider">
  Join the mailing list
</h3>

<div class="ui two column mobile tablet computer reversed divided grid">
  <div class="row">
    <div class="column">
      <p class="ui text tiny"><em>No spam and I usually send a newsletter once a week with writing you won't see on the blog.</em></p>
    </div>
    <div class="column">
      <div class="ui items" id="mc_embed_signup">
        <form action="https://kamranicus.us18.list-manage.com/subscribe/post?u=45a27b0b6fc6f929b90e35338&amp;id=89bb6697c0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
          <div class="item" id="mc_embed_signup_scroll">
            <div class="content">
              <div class="ui input">
                <input type="email" value="" name="EMAIL" placeholder="Your Email" class="required email" id="mce-EMAIL">
              </div>
              <div id="mce-responses" class="clear" style="margin-top: 1em;">
                <div class="response" id="mce-error-response" style="display:none"></div>
                <div class="response" id="mce-success-response" style="display:none"></div>
              </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_45a27b0b6fc6f929b90e35338_89bb6697c0" tabindex="-1" value=""></div>
              <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="ui primary button"></div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="ui horizontal divider">
  About Kamran
</div>

<div class="ui items">
  <div class="item">
    <div class="ui small circular image">
      <img src="/assets/images/me.jpg" title="Kamran Ayub">
    </div>

    <div class="content">
      <div class="description">
        <p>I&#x27;m a technologist, speaker, and Pluralsight author and I specialize in building full-stack solutions with a focus on modern web technology and cloud native architecture.</p>
        <p><a href="http://bit.ly/KamranOnPluralsight"><img src="/assets/images/pluralsight.png" alt="Kamran's Pluralsight courses" title="Check out my Pluralsight courses!" style="max-width:80%;margin:1em 0;"></a></p>
      </div>
      <div class="extra">
        <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="https://www.youtube.com/channel/UCq6oaAI3ZH2rGlmC9VqJm1g " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>

      </div>
    </div>
  </div>
</div>

<div id="fastcomments-widget"></div>

<script src="https://cdn.fastcomments.com/js/embed.min.js"></script>
<script>
    window.FastCommentsUI(document.getElementById('fastcomments-widget'), {
        tenantId: 'kdnCBxO7N',
        urlId: '2020-07-17-cypress-browser-permissions',
        url: 'https://kamranicus.com/posts/2020-07-17-cypress-browser-permissions',
        pageTitle: 'Controlling Browser Permissions in Cypress End-to-End Tests'
    });
</script>



      <!-- Disqus -->
    </div>
  </div>

  <div class="ui divider"></div>
  
  <!-- Footer -->
  <footer>   
    <div class="ui center aligned container">
  <p class="ui grey sub header">Copyright © Kamran Ayub 2021</p>
  
  <div class="ui basic vertical segment">
    <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="https://www.youtube.com/channel/UCq6oaAI3ZH2rGlmC9VqJm1g " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>

  </div>

  <p class="ui basic vertical segment">      
    <a href="http://feeds.feedburner.com/Kamranicus" class="ui right labeled icon button">
      Subscribe via RSS or email
      <i class="right rss icon"></i>
    </a>
  </p>  
  <p class="ui tiny basic vertical segment">
    <a href="https://wyam.io">Statically generated by Wyam</a>
  </p>
</div>

  </footer>

  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  <script src="/assets/ui/semantic.min.js"></script>
  <script src="/assets/js/highlight.pack.js"></script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6930375300621668",
          enable_page_level_ads: true
     });
</script>

  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
