<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

  <title>Kamranicus | Kamran Ayub - Using AngularJS 1.5 with webpack, babel, and Karma/Jest</title>
  <meta name="description" content="Kamran Ayub" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Kamran Ayub">

  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus (RSS)" type="application/atom+xml">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.png" type="image/png">

  <link href="/assets/ui/semantic.min.css" rel="stylesheet" />
  <link href="/assets/css/highlight.css" rel="stylesheet">

  <meta name="application-name" content="Kamranicus | Kamran Ayub" />
  <meta name="msapplication-tooltip" content="Kamranicus | Kamran Ayub" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Kamranicus | Kamran Ayub - Using AngularJS 1.5 with webpack, babel, and Karma/Jest" /> 
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kamranicus.com/posts/2017-10-06-webpack-karma-jest-babel-angularjs" />
  <meta property="og:site_name" content="Kamranicus" />
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:creator" content="@kamranayub" />

  <!-- TODO: More social graph meta tags -->
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": "Kamranicus",
      "url": "https://kamranicus.com/",
      "sameAs": [
        "http://www.twitter.com/kamranayub"
      ]
  }
  </script>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/assets/js/html5shiv.js"></script>
    <script src="/assets/js/respond.min.js"></script>
  <![endif]-->
  <script src="/assets/js/picturefill.min.js" async></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  

  


</head>

<body>

  <!-- Navigation -->
  <div class="ui container">
    <nav class="ui huge text site menu">
      
      <a class="header item" href="/">Kamranicus | Kamran Ayub</a>
      
      <div class="ui right item">
              <div class="item">
        <a href="/about">Contact</a>
      </div>
      <div class="item">
        <a href="/events">Events</a>
      </div>
      <div class="item">
        <a href="/guides">Guides</a>
      </div>
      <div class="item">
        <a href="/projects">Projects</a>
      </div>
      <div class="item">
        <a href="/training">Training</a>
      </div>
      <div class="item">
        <a href="/travel">Travel</a>
      </div>

      </div>
    </nav>
  </div>
  <!-- Page Header -->

  <header class="ui vertical masthead segment  " id="intro-header">
    <div class="ui container">

    
<div class="ui basic vertical segment">
    <h1 class="ui  huge header">
      Using AngularJS 1.5 with webpack, babel, and Karma/Jest
        <div class="ui sub header">Living in harmony with Karma/Jest, webpack, and babel with AngularJS 1.5</div>
    </h1>
                
    <div class="ui  sub header">        
Published on Friday, October 6, 2017<br>    </div>
        <div class="ui basic vertical spaced segment">
                    <a role="button" href="/tags/AngularJS" class="ui small compact button">AngularJS</a>
                    <a role="button" href="/tags/Babel" class="ui small compact button">Babel</a>
                    <a role="button" href="/tags/JavaScript" class="ui small compact button">JavaScript</a>
                    <a role="button" href="/tags/Jest" class="ui small compact button">Jest</a>
                    <a role="button" href="/tags/Karma" class="ui small compact button">Karma</a>
                    <a role="button" href="/tags/Testing" class="ui small compact button">Testing</a>
                    <a role="button" href="/tags/Webpack" class="ui small compact button">Webpack</a>
        </div>     
</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="ui stackable grid container">
    <div class="content column">
      

<div class="ui huge basic post content segment">
  <p>This took me awhile to get right so I'm sharing my experience trying to get webpack 3, babel 6, and Karma to work together for testing Angular 1.5 apps. I also have an example using Jest, which I actually prefer over Karma.</p>
<h2 id="some-context">Some context</h2>
<p>Why bother with these modern build tools and Karma/Angular 1.5? Why not upgrade to ng 4 or migrate to React? For our team, there isn't yet a compelling reason to go and rewrite several apps when the product is stable and in production. Since code is spread out across several repositories and the team works in multiple codebases at a time, consistency is key.</p>
<p>That said, we still want to be happy writing JavaScript and Babel+Webpack+ES2015 is a great combination.</p>
<p><strong>Note:</strong> I was actually using <a href="https://facebook.github.io/jest/">Jest</a> originally which worked great with Angular 1.5 <em>and</em> our Node.js code! I'd highly recommend it <em>instead</em> of Karma/Jasmine/Mocha/Chai because it's a single dependency with easy configuration. We switched back to Karma to maintain consistency with the rest of our codebases. Here's an <a href="https://github.com/kamranayub/angularjs-sample-webpack-es6-jest">example repo</a>.</p>
<h2 id="show-me-the-code">Show me the code</h2>
<p>You probably are reading this because you're struggling right now to get the puzzle pieces to fit.</p>
<p>With that in mind, here's a fully working repository with some specs to help you get off the ground.</p>
<ul>
<li>Karma: <a href="https://github.com/kamranayub/angularjs-sample-webpack-es6-karma">https://github.com/kamranayub/angularjs-sample-webpack-es6-karma</a></li>
<li>Jest: <a href="https://github.com/kamranayub/angularjs-sample-webpack-es6-jest">https://github.com/kamranayub/angularjs-sample-webpack-es6-jest</a></li>
</ul>
<p><strong>This is not meant to be a &quot;starter&quot; but you can use it however you want.</strong></p>
<p>Read on if you need specifics on each part of the puzzle.</p>
<h2 id="prior-art">Prior art</h2>
<p>When I was trying to get my setup working, I referenced the following posts:</p>
<ul>
<li><a href="http://mike-ward.net/2015/09/07/tips-on-setting-up-karma-testing-with-webpack/">Tips on setting up Karma testing with webpack</a> - Mike Ward, Sep 2015</li>
<li><a href="https://github.com/TheLarkInn/angular-starter-es6-webpack">angular-starter-es6-webpack</a> - Sean Larkin, Aug 2016</li>
</ul>
<h2 id="configuring-webpack-babel">Configuring webpack &amp; Babel</h2>
<p>There's nothing different with my webpack or babel configuration when using Karma. Follow the standard setup guide for <a href="https://github.com/babel/babel-loader">Babel + Webpack</a>. The one addition I have is the <a href="https://www.npmjs.com/package/babel-plugin-angularjs-annotate">babel-plugin-angularjs-annotate</a> which is handy for dependency injection.</p>
<h2 id="configuring-karma">Configuring karma</h2>
<p>This was the time suck. No matter what, it seemed I couldn't get things to process/compile the way I wanted.</p>
<p>The root of my issue was that my webpack configuration was actually an <em>array</em> of configuration objects and I was passing the array to the <code>webpack</code> karma middleware and it expects a <strong>single</strong> configuration. My bad.</p>
<p>Here's the relevant snippet:</p>
<pre><code class="language-js">    // This will be the new entry to webpack
    // so it should just be a single file
    files: [&quot;src/index.tests.js&quot;],

    // Preprocess test index and test files using
    // webpack (will run babel)
    preprocessors: {
      &quot;src/index.tests.js&quot;: [&quot;webpack&quot;],
      &quot;src/**/*.test.js&quot;: [&quot;webpack&quot;]
    },

    // Reference webpack config (single object)
    // and configure some middleware settings
    webpack: require(&quot;./webpack.config&quot;),
    webpackMiddleware: {
      noInfo: true,
      stats: &quot;errors-only&quot;
    },
</code></pre>
<p>I seemed to run into some issues when I tried using a glob pattern for the <code>files</code> array, like <code>**/*.test.js</code> so I switched to using a single file and that seemed to calm webpack down.</p>
<p>That <strong>index.tests.js</strong> file looks like:</p>
<pre><code class="language-js">import &quot;angular&quot;;
import &quot;angular-mocks&quot;;

// require all test files using special Webpack feature
// https://webpack.github.io/docs/context.html#require-context
const testsContext = require.context(&quot;.&quot;, true, /\.test$/);
testsContext.keys().forEach(testsContext);
</code></pre>
<p>Key here the initial imports to set up Angular and Angular mock globals. The rest uses Webpack's module API to require the test files.</p>
<h2 id="writing-an-angular-test">Writing an Angular test</h2>
<p>With this in place, we can write a simple component controller test in ES6!</p>
<p><a href="https://github.com/kamranayub/angularjs-sample-webpack-es6-karma/blob/master/src/dummy.component.test.js">https://github.com/kamranayub/angularjs-sample-webpack-es6-karma/blob/master/src/dummy.component.test.js</a></p>
<p>For more information on the pattern I'm using, check out <a href="https://puigcerber.com/2016/02/07/how-to-test-angular-1-5-components/">Pablo's post on Angular 1.5 component testing</a>.</p>

</div>

<h3 class="ui horizontal divider">
  Don't miss any updates!
</h3>

<div class="ui two column mobile tablet computer reversed divided grid">
  <div class="row">
    <div class="column">
      <p class="ui text tiny"><em>No spam and I usually send a newsletter once a quarter with content you won't see on the blog.</em></p>
    </div>
    <div class="column">
      <div class="ui items" id="mc_embed_signup">
        <form action="https://kamranicus.us18.list-manage.com/subscribe/post?u=45a27b0b6fc6f929b90e35338&amp;id=89bb6697c0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
          <div class="item" id="mc_embed_signup_scroll">
            <div class="content">
              <div class="ui input">
                <input type="email" value="" name="EMAIL" placeholder="Your Email" class="required email" id="mce-EMAIL">
              </div>
              <div id="mce-responses" class="clear" style="margin-top: 1em;">
                <div class="response" id="mce-error-response" style="display:none"></div>
                <div class="response" id="mce-success-response" style="display:none"></div>
              </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_45a27b0b6fc6f929b90e35338_89bb6697c0" tabindex="-1" value=""></div>
              <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="ui primary button"></div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="ui horizontal divider">
  About Kamran
</div>

<div class="ui items">
  <div class="item">
    <div class="ui small circular image">
      <img src="/assets/images/me.jpg" title="Kamran Ayub">
    </div>

    <div class="content">
      <div class="description">
        <p>I&#x27;m a technologist, speaker, and Pluralsight author and I specialize in building full-stack solutions with a focus on modern web technology and cloud native architecture.</p>
        <p><a href="http://bit.ly/KamranOnPluralsight"><img src="/assets/images/pluralsight.png" alt="Kamran's Pluralsight courses" title="Check out my Pluralsight courses!" style="max-width:80%;margin:1em 0;"></a></p>
      </div>
      <div class="extra">
        <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
      </div>
    </div>
  </div>
</div>

<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = '2017-10-06-webpack-karma-jest-babel-angularjs';
    var disqus_title = 'Using AngularJS 1.5 with webpack, babel, and Karma/Jest';
    var disqus_url = 'https://kamranicus.com/posts/2017-10-06-webpack-karma-jest-babel-angularjs';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <!-- Disqus -->
    </div>
  </div>

  <div class="ui divider"></div>
  
  <!-- Footer -->
  <footer>   
    <div class="ui center aligned container">
  <p class="ui grey sub header">Copyright © Kamran Ayub 2020</p>
  
  <div class="ui basic vertical segment">
    <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
  </div>

  <p class="ui basic vertical segment">      
    <a href="http://feeds.feedburner.com/Kamranicus" class="ui right labeled icon button">
      Subscribe via RSS or email
      <i class="right rss icon"></i>
    </a>
  </p>  
  <p class="ui tiny basic vertical segment">
    <a href="https://wyam.io">Statically generated by Wyam</a>
  </p>
</div>

  </footer>

  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  <script src="/assets/ui/semantic.min.js"></script>
  <script src="/assets/js/highlight.pack.js"></script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6930375300621668",
          enable_page_level_ads: true
     });
</script>

  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>