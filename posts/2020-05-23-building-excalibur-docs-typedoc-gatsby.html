<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

  <title>Kamranicus | Kamran Ayub - Building a TypeDoc-powered Gatsby Documentation Site</title>
  <meta name="description" content="Kamran Ayub" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Kamran Ayub">

  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus (RSS)" type="application/atom+xml">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.png" type="image/png">

  <link href="/assets/ui/semantic.min.css" rel="stylesheet" />
  <link href="/assets/css/highlight.css" rel="stylesheet">

  <meta name="monetization" content="$ilp.uphold.com/GkRBn6N6hM9q" />
  
  <meta name="application-name" content="Kamranicus | Kamran Ayub" />
  <meta name="msapplication-tooltip" content="Kamranicus | Kamran Ayub" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Kamranicus | Kamran Ayub - Building a TypeDoc-powered Gatsby Documentation Site" /> 
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://kamranicus.com/posts/2020-05-23-building-excalibur-docs-typedoc-gatsby" />
  <meta property="og:site_name" content="Kamranicus" />
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:creator" content="@kamranayub" />

  <!-- TODO: More social graph meta tags -->
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": "Kamranicus",
      "url": "https://kamranicus.com/",
      "sameAs": [
        "http://www.twitter.com/kamranayub"
      ]
  }
  </script>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/assets/js/html5shiv.js"></script>
    <script src="/assets/js/respond.min.js"></script>
  <![endif]-->
  <script src="/assets/js/picturefill.min.js" async></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  

  


</head>

<body>

  <!-- Navigation -->
  <div class="ui container">
    <nav class="ui huge text site menu">
      
      <a class="header item" href="/">Kamranicus | Kamran Ayub</a>
      
      <div class="ui right item">
              <div class="item">
        <a href="/about">Contact</a>
      </div>
      <div class="item">
        <a href="/events">Events</a>
      </div>
      <div class="item">
        <a href="/guides">Guides</a>
      </div>
      <div class="item">
        <a href="/projects">Projects</a>
      </div>
      <div class="item">
        <a href="/training">Training</a>
      </div>
      <div class="item">
        <a href="/travel">Travel</a>
      </div>

      </div>
    </nav>
  </div>
  <!-- Page Header -->

  <header class="ui vertical masthead segment  " id="intro-header">
    <div class="ui container">

    
<div class="ui basic vertical segment">
    <h1 class="ui  huge header">
      Building a TypeDoc-powered Gatsby Documentation Site
        <div class="ui sub header">We recently migrated our user-facing documentation to Gatsby and it&#x27;s still powered by TypeDoc symbols</div>
    </h1>
                
    <div class="ui  sub header">        
    </div>
        <div class="ui basic vertical spaced segment">
                    <a role="button" href="/tags/Excalibur" class="ui small compact button">Excalibur</a>
                    <a role="button" href="/tags/Gatsby" class="ui small compact button">Gatsby</a>
                    <a role="button" href="/tags/JavaScript" class="ui small compact button">JavaScript</a>
                    <a role="button" href="/tags/TypeScript" class="ui small compact button">TypeScript</a>
        </div>     
</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="ui stackable grid container">
    <div class="content column">
      

<div class="ui huge basic post content segment">
  <p>I help maintain the <a href="https://excaliburjs.com">Excalibur.js</a> web-based game engine. We started Excalibur back in 2011 and it was always written from the ground up in TypeScript. Since Excalibur hasn't yet reached 1.0, all of our documentation has been in the source code. Luckily, early on we started to adopt a tool called <a href="https://typedoc.org">Typedoc</a> which could generate a rich documentation site for TypeScript-based projects.</p>
<h2 id="linking-to-api-symbols">Linking to API Symbols</h2>
<p>Using TypeDoc, we could build richer documentation with embedded Markdown documents. It also has a compelling feature to do <a href="http://typedoc.org/guides/doccomments/#symbol-references">link to API symbols</a> using a <code>[[symbolName]]</code> or <code>{&#64;link symbolName}</code> syntax. This was awesome because we could write &quot;user-facing&quot; documentation and easily create maintainable links to the raw API symbols.</p>
<p>Since we could separate user-facing documentation into separate <code>.md</code> files, TypeDoc allowed us to use <code>[[include:file.md]]</code> directives to keep our documentation separate from the source code.</p>
<p>This approach has been working well for us in the past years but there were several downsides:</p>
<ul>
<li>The &quot;user&quot; documentation was locked into the TypeDoc site and theme</li>
<li>While TypeDoc was customizable, it was still hard to do more complex things like custom components (think MDX) or rendering</li>
<li>It just wasn't cohesive--we had a main site and you'd expect to find docs hosted under there. It would take a lot of work to customize the TypeDoc theme enough to make it feel like a natural part of the site.</li>
</ul>
<p>We needed to do something different and <em>ideally</em> have these user docs hosted within the main site <strong>but still maintain the ability to easily link to API docs</strong>.</p>
<h2 id="migrating-to-gatsby.js">Migrating to Gatsby.js</h2>
<p>Awhile back, I converted our site to be statically generated using <a href="https://gatsbyjs.org">Gatsby.js</a> and this has proved to be a good decision. Gatsby allows us to customize all the aspects of the site including the way we generate documentation.</p>
<p>Gatsby uses a GraphQL-based sourcing architecture where you can add any kind of &quot;source&quot; of data--this could be Wordpress, the GitHub API, or basically <em>any</em> external piece of data you wanted. These source plugins take the data from one place and <em>transform</em> it into GraphQL nodes that Gatsby can understand and make available to your pages statically. This makes Gatsby incredibly versatile and customizable using a consistent architecture.</p>
<p>Gatsby also has the idea of <em>transformers</em>. Transformers take input, usually an Abstract Syntax Tree (AST) and run it through processors that make changes. For example, there's <a href="%5Bhttps://www.gatsbyjs.org/packages/gatsby-transformer-remark/%5D(https://www.gatsbyjs.org/packages/gatsby-transformer-remark/)">gatsby-transformer-remark</a> that takes Markdown AST and parses it using Remark.</p>
<p>Using a combination of <em>sources</em> and <em>transformers</em> you can basically transform one source of data into whatever you want as the output.</p>
<h2 id="creating-a-typedoc-gatsby-source">Creating a TypeDoc Gatsby Source</h2>
<p>When we migrated our user documentation, we didn't want to lose the ability to link to the API symbols using the convenient <code>[[symbol]]</code> syntax. In order to maintain that, we needed a way to source the TypeDoc JSON (or AST) into our Gatsby site.</p>
<p>For that purpose, I made an npm package <a href="https://npmjs.com/package/gatsby-source-typedoc">gatsby-source-typedoc</a>. This will allow you to run TypeDoc against a TypeScript project and it will take the generated structure and store it as a GraphQL node for querying within your Gatsby app.</p>
<p>For example, here's what <a href="https://github.com/excaliburjs/excaliburjs.github.io/blob/site/gatsby-config.js#L10">Excalibur's Gatsby config looks like</a>:</p>
<pre><code class="language-js">plugins: [
  {
    resolve: 'gatsby-source-typedoc',
    options: {
      src: [
        `${__dirname}/ex/edge/src/engine/index.ts`,
        `${__dirname}/ex/edge/src/engine/globals.d.ts`,
        `${__dirname}/ex/edge/src/engine/files.d.ts`,
        `${__dirname}/ex/edge/src/engine/excalibur.d.ts`,
      ],
      typedoc: {
        target: 'es5',
        mode: 'modules',
        experimentalDecorators: true,
        excludePrivate: true,
        tsconfig: `${__dirname}/ex/edge/src/engine/tsconfig.json`,
      },
    },
  },
]
</code></pre>
<p>This will then allow you to query for the TypeDoc JSON content in a Gatsby page:</p>
<pre><code class="language-js">export const pageQuery = graphql`
  typedoc(typedocId: { eq: &quot;default&quot; }) {
    internal {
      content
    }
  }
`

export default function MyPage({ data: { typedoc } }) {
	const typedocContent = JSON.parse(typedoc?.internal.content);
	
	// do something with that data...
}
</code></pre>
<p>With this source package, it is enough to where you could build a custom Gatsby-based TypeDoc site since you now have complete access to the entire TypeDoc structure for your project. We didn't need to go that far, since we are happy with the TypeDoc default theme we use.</p>
<p>But we're still missing something important: parsing symbol links in our Markdown documentation.</p>
<h2 id="parsing-typedoc-symbol-links-in-markdown">Parsing TypeDoc Symbol Links in Markdown</h2>
<p>We write our user documentation using MDX, which is Markdown and React. For example, here's one snippet of document from the <a href="https://excaliburjs.com/docs/intro">Introduction page</a>:</p>
<pre><code class="language-md">To create a new game, create a new instance of [[Engine]] and pass in
the configuration ([[EngineOptions]]). Excalibur only supports a single
instance of a game at a time, so it is safe to use globally.
You can then call [[Engine.start|start]] which starts the game and optionally accepts
a [[Loader]] which you can use to [load assets](/docs/assets) like sprites and sounds.
</code></pre>
<p>Notice how we have multiple symbol links denoted by the <code>[[ ]]</code> syntax, including some with aliases like <code>[[Engine.start|start]]</code>.</p>
<p>If you run this through a Markdown parser, the only link that gets transformed is the &quot;load assets&quot; link because by default, Markdown has no idea what the <code>[[ ]]</code> syntax is! Somehow, we need to take the GraphQL TypeDoc source node(s) we generated and then run our Markdown through a <em>transformer</em> to convert these links to Markdown links.</p>
<p>To accomplish this, I released two packages: <a href="https://www.npmjs.com/package/remark-typedoc-symbol-links">remark-typedoc-symbol-links</a> and <a href="https://www.npmjs.com/package/gatsby-remark-typedoc-symbol-links">gatsby-remark-typedoc-symbol-links</a>.</p>
<p>Here is how this works in Gatsby, which was a completely new learning experience for me:</p>
<ul>
<li>Gatsby loads the MDX file</li>
<li>Gatsby then runs it through <code>gatsby-plugin-mdx</code></li>
<li><code>gatsby-plugin-mdx</code> runs the Markdown through Remark, a Markdown parser</li>
<li>Remark supports plugins, that can take the Markdown AST (mdast) and modify it</li>
<li>Gatsby supports special Gatsby Transformer Remark plugins which have access to <em>both</em> the Gatsby API <strong>and</strong> the Markdown AST</li>
<li>This pipeline uses <a href="https://github.com/unifiedjs/unified">unified.js</a> as the underlying API at the lowest level</li>
</ul>
<p>So, what I needed to do was to make a Gatsby Remark Transformer plug-in. Since Gatsby just delegates down to Remark, I was able to split this up into two packages, just in case someone wanted to use the Typedoc symbol transformer outside Gatsby. The symbol transformer only needs one additional piece of input: the TypeDoc AST.</p>
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTI2MzQ0NTE1NywxMzY3MDQzMTcsLTg5MD
YyOTk0LC05NzI5MDg5NjIsLTY3OTE3OTEyXX0=
-->

</div>

<h3 class="ui horizontal divider">
  Don't miss any updates!
</h3>

<div class="ui two column mobile tablet computer reversed divided grid">
  <div class="row">
    <div class="column">
      <p class="ui text tiny"><em>No spam and I usually send a newsletter once a quarter with content you won't see on the blog.</em></p>
    </div>
    <div class="column">
      <div class="ui items" id="mc_embed_signup">
        <form action="https://kamranicus.us18.list-manage.com/subscribe/post?u=45a27b0b6fc6f929b90e35338&amp;id=89bb6697c0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
          <div class="item" id="mc_embed_signup_scroll">
            <div class="content">
              <div class="ui input">
                <input type="email" value="" name="EMAIL" placeholder="Your Email" class="required email" id="mce-EMAIL">
              </div>
              <div id="mce-responses" class="clear" style="margin-top: 1em;">
                <div class="response" id="mce-error-response" style="display:none"></div>
                <div class="response" id="mce-success-response" style="display:none"></div>
              </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_45a27b0b6fc6f929b90e35338_89bb6697c0" tabindex="-1" value=""></div>
              <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="ui primary button"></div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="ui horizontal divider">
  About Kamran
</div>

<div class="ui items">
  <div class="item">
    <div class="ui small circular image">
      <img src="/assets/images/me.jpg" title="Kamran Ayub">
    </div>

    <div class="content">
      <div class="description">
        <p>I&#x27;m a technologist, speaker, and Pluralsight author and I specialize in building full-stack solutions with a focus on modern web technology and cloud native architecture.</p>
        <p><a href="http://bit.ly/KamranOnPluralsight"><img src="/assets/images/pluralsight.png" alt="Kamran's Pluralsight courses" title="Check out my Pluralsight courses!" style="max-width:80%;margin:1em 0;"></a></p>
      </div>
      <div class="extra">
        <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
      </div>
    </div>
  </div>
</div>

<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = '2020-05-23-building-excalibur-docs-typedoc-gatsby';
    var disqus_title = 'Building a TypeDoc-powered Gatsby Documentation Site';
    var disqus_url = 'https://kamranicus.com/posts/2020-05-23-building-excalibur-docs-typedoc-gatsby';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <!-- Disqus -->
    </div>
  </div>

  <div class="ui divider"></div>
  
  <!-- Footer -->
  <footer>   
    <div class="ui center aligned container">
  <p class="ui grey sub header">Copyright © Kamran Ayub 2020</p>
  
  <div class="ui basic vertical segment">
    <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
  </div>

  <p class="ui basic vertical segment">      
    <a href="http://feeds.feedburner.com/Kamranicus" class="ui right labeled icon button">
      Subscribe via RSS or email
      <i class="right rss icon"></i>
    </a>
  </p>  
  <p class="ui tiny basic vertical segment">
    <a href="https://wyam.io">Statically generated by Wyam</a>
  </p>
</div>

  </footer>

  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  <script src="/assets/ui/semantic.min.js"></script>
  <script src="/assets/js/highlight.pack.js"></script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6930375300621668",
          enable_page_level_ads: true
     });
</script>

  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
